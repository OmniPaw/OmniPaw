---
title: Security Invariants
description: Deep dive into the 15 mathematical guardrails that prevent agent corruption and unauthorized tool execution.
navigation:
  icon: i-lucide-shield-check
seo:
  title: OmniPaw - Security Invariants
  description: Technical specification for the OmniPaw kernel's internal security checks and invariant enforcement.
---

# Security Invariants

OmniPaw is structurally governed by **15 Core Invariants**. These are not just "best practices" or "lint rules"—they are active, runtime checks performed by the kernel on every single state transition.

If an invariant is breached, the kernel triggers a `Kernel Panic` and halts execution immediately. This prevents a "hallucinating" agent from making irreversible changes to the system or accessing unauthorized memory.

## The Invariant Enforcement Cycle

The `InvariantChecker` runs at the end of every **Tick**. It compares the proposed state delta against the following mathematical constraints:

1.  **Instruction Integrity**: Is the command being executed identical to the one signed in the queue?
2.  **Memory Boundary**: Is the agent attempting to write to a memory address outside its `AgentStore`?
3.  **Permission Guard**: Does the agent possess the cryptographic token required for this specific [ToolGate](/en/concepts/tool-permissions) operation?

## Top Security Invariants

| ID         | Name                 | Threat Mitigated                                                                    |
| :--------- | :------------------- | :---------------------------------------------------------------------------------- |
| **INV-01** | instruction_finality | Prevents prompt-injection from modifying a queued command.                          |
| **INV-03** | store_isolation      | Blocks cross-agent memory leaks (unless via SharedStore).                           |
| **INV-07** | tick_atomicity       | Ensures partial failures (e.g., timeout) don't leave the system in a corrupt state. |
| **INV-12** | sandbox_confinement  | Verifies that a tool execution did not escape its L2/L3 sandbox.                    |
| **INV-15** | replay_parity        | Guarantees that REPLAY mode exactly matches the original LIVE trace.                |

## Handling an Invariant Breach

When a breach occurs, the kernel emits a `PANIC` event. Developers can handle this event to trigger automated recovery or diagnostic dumping.

```typescript
kernel.lifecycle.on("PANIC", (event) => {
  console.error(`CRITICAL: Invariant ${event.invariantId} breached!`);
  // Automatically dump memory for forensics
  kernel.storage.dumpState("./forensics/panic_dump.json");
});
```

### Divergence Detection

In **REPLAY** mode, if the re-executed hash doesn't match the original log's hash, it's treated as a `TRACE_DIVERGENCE`. This is the ultimate security invariant—proving that the execution path has remained untampered.

Next: Learn about [Isolated Tool Execution](/en/essentials/isolated-tools).
