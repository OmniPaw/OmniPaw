---
title: Isolated Tool Execution
description: Learn how OmniPaw executes high-stakes commands (e.g., shell scripts, Python) in strictly isolated environments.
navigation:
  icon: i-lucide-box
seo:
  title: OmniPaw - Isolated Tool Execution
  description: Principles of tool isolation, process forking, and side-effect recording.
---

# Isolated Tool Execution

In traditional agent systems, tools often run with the same permissions as the main process. This is a massive security risk. In OmniPaw, tools are treated as **Untrusted Externals**.

Before a tool can even be initialized, it must be defined as an `IsolatedTool` within the kernel's `ToolRegistry`.

## Tool Isolation Principles

To ensure the safety of the host system, the OmniPaw kernel enforces three layers of isolation:

1.  **Process Forking**: Tools run in a separate process, preventing a crash or malformed memory access from affecting the kernel.
2.  **Explicit In-Out Contracts**: Only data that matches the tool's JSON Schema is allowed in, and only valid response payloads are allowed back into the `AgentStore`.
3.  **Side-Effect Recording**: In **LIVE** mode, every tool call's result is recorded. In **REPLAY** mode, the tool is never actually calledâ€”the recorded result is injected instead.

## Defining an Isolated Tool

To create a new tool, implement the `IsolatedTool` interface:

```typescript [tools/fs-tool.ts]
import { IsolatedTool } from "@omnipaw/kernel/tools";

export const readFile = new IsolatedTool({
  name: "read_secure_file",
  description: "Reads contents of a file within the sandbox bounds.",
  parameters: {
    type: "object",
    properties: {
      path: { type: "string" },
    },
    required: ["path"],
  },
  handler: async (args) => {
    // This handler will be executed within the L2 or L3 sandbox
    return await fs.promises.readFile(args.path, "utf-8");
  },
});
```

## Tool Life Cycle

When an agent requests a tool call, the following flow occurs:

1.  **Validation**: The kernel verifies the agent has `PermissionGrant` for the tool.
2.  **Isolation Prep**: The kernel prepares the L2 (Chroot) or L3 (Docker) sandbox.
3.  **Execution**: The tool runs, and its output is captured.
4.  **Hashed Return**: The output is hashed, and the `StateHash` is updated before returning control to the agent.

### Logging Tool Output

Tool outputs are natively integrated into the [OmniTracePreview](/en/getting-started/quickstart) component. You can see the full log of every `bash` command or `fetch` request in real-time.

Next: Explore the [Sandboxing Layers](/en/essentials/sandboxing-layers).
